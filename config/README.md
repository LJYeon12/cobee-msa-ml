# Config 설정 파일 가이드

이 문서는 `config.json` 파일의 각 설정 항목에 대한 상세한 설명을 제공합니다.

## 파일 구조 개요

```json
{
  "version": "버전 정보",
  "last_updated": "마지막 업데이트 시간",
  "phase": { ... },
  "weights": { ... },
  "recommendation": { ... },
  "features": { ... },
  "model": { ... },
  "cache": { ... }
}
```

---

## phase - Phase 관리

현재 추천 시스템의 Phase 상태와 전환 기준을 정의합니다.

### 필드 설명

#### `current` (string)
- **설명**: 현재 활성화된 Phase
- **가능한 값**: "P1", "P2", "P3"
- **기본값**: "P1"
- **변경 시점**: `update_phase.py` 스크립트가 매일 자동으로 업데이트

#### `interaction_count` (integer)
- **설명**: 현재까지 누적된 상호작용 총합 (ApplyRecord + Bookmark)
- **범위**: 0 이상
- **업데이트**: 매일 새벽 `update_phase.py`가 계산하여 업데이트

#### `thresholds` (object)
각 Phase의 상호작용 수 범위를 정의합니다.

- **P1**: 0~99개 (Cold Start - Rule-Based 전용)
- **P2**: 100~999개 (Transition - 하이브리드 전환기)
- **P3**: 1000개 이상 (Mature - MF 주도)

---

## weights - Phase별 모델 가중치

각 Phase에서 Rule-Based와 Matrix Factorization의 혼합 비율을 정의합니다.

### P1 (Cold Start)

#### `rule_based` (float: 1.0)
- **설명**: Rule-Based 추천의 가중치
- **의미**: P1에서는 100% Rule-Based만 사용
- **사용 데이터**: 사용자 선호도(user_preferences)와 구인글 공개 프로필(public_profile)만 사용

#### `matrix_factorization` (float: 0.0)
- **설명**: MF 추천의 가중치
- **의미**: P1에서는 MF를 사용하지 않음 (데이터 부족)
- **이유**: 상호작용 데이터가 충분하지 않아 MF 학습 불가

### P2 (Transition)

#### `rule_based` (float: 0.6)
- **설명**: Rule-Based 추천의 가중치 (60%)
- **범위**: P2 구간 내에서 100→999로 갈수록 0.6에서 선형 감소

#### `matrix_factorization` (float: 0.4)
- **설명**: MF 추천의 가중치 (40%)
- **범위**: P2 구간 내에서 100→999로 갈수록 0.4에서 선형 증가

#### `interpolation` (string: "linear")
- **설명**: 가중치 보간 방식
- **가능한 값**: "linear" (선형 보간)
- **효과**: 상호작용 수가 증가함에 따라 MF 비중이 점진적으로 증가

#### `rejected_penalty` (boolean: true)
- **설명**: REJECTED 지원 기록에 패널티 적용 여부
- **효과**: 사용자가 거절한 유형의 게시글 점수를 낮춤

### P3 (Mature)

#### `rule_based` (float: 0.2)
- **설명**: Rule-Based 추천의 가중치 (20%)
- **의미**: 최종 필터링 및 보조 역할

#### `matrix_factorization` (float: 0.8)
- **설명**: MF 추천의 가중치 (80%)
- **의미**: MF가 주도적 역할 수행

#### `interpolation` (string: "linear")
- **설명**: 가중치 보간 방식
- **효과**: P3 구간 내에서도 선형 보간 적용 가능

#### `rejected_penalty` (boolean: true)
- **설명**: REJECTED 지원 기록에 패널티 적용
- **효과**: 과거 거절 패턴을 학습하여 추천 품질 향상

---

## recommendation - 추천 결과 제어

사용자에게 제공되는 추천 결과의 특성을 제어합니다.

### 필드 설명

#### `default_limit` (integer: 20)
- **설명**: 기본 추천 항목 개수
- **범위**: 1~100 권장
- **사용**: API 요청 시 limit 파라미터가 없으면 이 값 사용
- **조정 가이드**: 
  - 10~15: 모바일 앱, 빠른 스크롤
  - 20~30: 웹 페이지, 일반적 사용
  - 50+: 탐색 위주 UI

#### `min_score_threshold` (float: 0.3)
- **설명**: 추천 점수 최소 임계값
- **범위**: 0.0~1.0
- **의미**: 이 값보다 낮은 점수의 항목은 추천에서 제외
- **조정 가이드**:
  - 0.1~0.2: 관대한 기준 (더 많은 추천)
  - 0.3~0.5: 표준 기준
  - 0.6+: 엄격한 기준 (고품질 추천)

#### `diversity_factor` (float: 0.1)
- **설명**: 추천 다양성 조절 파라미터
- **범위**: 0.0~1.0
- **의미**:
  - 0.0: 순수 점수 기반 (유사한 항목 집중)
  - 1.0: 최대 다양성 (다양한 항목 분산)
- **효과**: 비슷한 지역/유형의 게시글이 독점하지 않도록 분산
- **조정 가이드**:
  - 0.0~0.2: 정확도 우선
  - 0.3~0.5: 균형
  - 0.6~1.0: 탐색 우선

#### `include_explanations` (boolean: true)
- **설명**: 추천 이유 설명 포함 여부
- **true**: API 응답에 추천 근거 포함 (예: "생활 패턴 85% 일치")
- **false**: 추천 목록만 반환 (응답 속도 약간 향상)
- **권장**: 사용자 경험을 위해 true 유지

---

## features - 추천에 사용할 데이터 신호

어떤 사용자 행동 데이터를 추천 계산에 포함할지 결정합니다.

### 필드 설명

#### `use_comment_signals` (boolean: true)
- **설명**: 댓글 데이터 사용 여부
- **true**: 댓글을 긍정적 관심 신호로 해석
- **false**: 댓글 무시 (노이즈가 많을 경우)
- **효과**: P1 Phase에서 댓글 가산점에 영향
- **비활성화 고려 시**: 스팸성 댓글이 많거나 품질이 낮은 경우

#### `use_bookmark_signals` (boolean: true)
- **설명**: 북마크(관심 표시) 데이터 사용 여부
- **권장**: 항상 true (명시적 긍정 신호)
- **효과**: 사용자가 관심 표시한 게시글 유형을 학습

#### `use_apply_record_signals` (boolean: true)
- **설명**: 지원 기록 데이터 사용 여부
- **권장**: 항상 true (가장 강한 신호)
- **효과**: 
  - ACCEPTED: 강한 긍정 신호
  - REJECTED: 부정 신호 (피해야 할 패턴)
  - PENDING: 중립 또는 약한 긍정 신호

#### `temporal_decay_enabled` (boolean: false)
- **설명**: 시간 경과에 따른 신호 감쇠 적용 여부
- **false**: 모든 과거 데이터 동일하게 취급
- **true**: 오래된 데이터일수록 가중치 감소
- **활성화 시기**: 충분한 데이터 축적 후 (6개월 이상 운영)
- **효과**: 사용자 선호 변화 반영
- **구현 예**: 3개월 전 데이터는 50% 가중치, 6개월 전은 25%

---

## model - Matrix Factorization 하이퍼파라미터

MF 모델 학습 시 사용되는 파라미터들입니다.

### 필드 설명

#### `mf_algorithm` (string: "SVD")
- **설명**: 사용할 MF 알고리즘 종류
- **가능한 값**:
  - "SVD": Singular Value Decomposition (기본, 가장 안정적)
  - "SVD++": SVD의 개선 버전 (암시적 피드백 추가)
  - "NMF": Non-negative Matrix Factorization
- **권장**: 초기에는 SVD 사용
- **변경 시**: MLflow로 다른 알고리즘 성능 비교 후 결정

#### `n_factors` (integer: 50)
- **설명**: 잠재 요인(latent factor) 개수
- **의미**: 사용자/아이템 임베딩 벡터의 차원 수
- **범위**: 10~200
- **조정 가이드**:
  - 10~30: 데이터 적음, 빠른 학습
  - 50~100: 표준 (권장)
  - 100+: 데이터 많음, 복잡한 패턴
- **트레이드오프**: 높을수록 표현력 증가, 과적합 위험 증가

#### `n_epochs` (integer: 20)
- **설명**: 학습 반복 횟수 (에포크)
- **범위**: 10~50 권장
- **의미**: 전체 데이터를 몇 번 반복 학습할지
- **조정 가이드**:
  - 10~15: 빠른 실험
  - 20~30: 표준
  - 40+: 데이터 많고 복잡할 때
- **주의**: 너무 많으면 과적합, 너무 적으면 미학습

#### `lr_all` (float: 0.005)
- **설명**: 학습률 (learning rate)
- **범위**: 0.001~0.01
- **의미**: 각 학습 단계에서 파라미터 업데이트 크기
- **조정 가이드**:
  - 0.001~0.003: 안정적, 느린 학습
  - 0.005~0.007: 표준 (권장)
  - 0.01+: 빠르지만 불안정
- **증상별 조정**:
  - 학습 불안정 → 낮춤
  - 학습 너무 느림 → 높임

#### `reg_all` (float: 0.02)
- **설명**: 정규화 파라미터 (regularization)
- **범위**: 0.01~0.1
- **의미**: 모델 복잡도 제약 강도
- **조정 가이드**:
  - 0.01: 약한 정규화 (복잡한 패턴 학습)
  - 0.02~0.05: 표준 (권장)
  - 0.1+: 강한 정규화 (과적합 방지)
- **증상별 조정**:
  - 훈련 성능 좋으나 검증 성능 나쁨 (과적합) → 높임
  - 훈련/검증 모두 성능 낮음 (미학습) → 낮춤

#### `min_training_samples` (integer: 100)
- **설명**: MF 학습을 위한 최소 상호작용 수
- **의미**: 이 값보다 데이터가 적으면 MF 학습 건너뜀
- **권장**: 50~200
- **이유**: 너무 적은 데이터로 학습하면 무의미한 패턴 학습
- **조정**: 초기에는 낮게(50), 안정화 후 높임(200)

---

## cache - Redis 캐싱 전략

추천 결과 캐싱을 통한 성능 최적화 설정입니다.

### 필드 설명

#### `enabled` (boolean: true)
- **설명**: 캐싱 기능 활성화 여부
- **true**: Redis에 추천 결과 저장 및 재사용
- **false**: 매번 새로 계산 (개발/디버깅 시)
- **효과**: API 응답 속도 대폭 향상 (계산 시간 0.5초 → 0.01초)
- **권장**: 프로덕션에서는 항상 true

#### `ttl_seconds` (integer: 3600)
- **설명**: 캐시 유효 시간 (초 단위)
- **범위**: 300~7200 (5분~2시간)
- **의미**: 이 시간이 지나면 캐시 자동 삭제, 다음 요청 시 재계산
- **조정 가이드**:
  - 300~600 (5~10분): 실시간성 중요
  - 1800~3600 (30분~1시간): 표준 (권장)
  - 3600+ (1시간+): 계산 비용 절감 우선
- **트레이드오프**: 짧을수록 최신 추천, 길수록 캐시 효율

#### `invalidation_on_interaction` (boolean: false)
- **설명**: 사용자 상호작용 시 캐시 즉시 무효화 여부
- **false**: TTL 기반으로만 만료 (권장)
- **true**: 북마크/지원 등 행동 시 해당 사용자 캐시 삭제
- **트레이드오프**:
  - true: 항상 최신 추천, 캐시 효율 감소
  - false: 약간의 지연, 높은 캐시 효율
- **활성화 고려 시**: 사용자가 실시간 반영을 강하게 요구하는 경우

---

## 설정 변경 가이드

### Phase 전환 임계값 수정

상호작용 데이터가 예상보다 빠르게/느리게 쌓이는 경우:

```json
"thresholds": {
  "P1": { "min": 0, "max": 149 },      // 기존 99 → 149
  "P2": { "min": 150, "max": 1499 },   // 기존 100~999
  "P3": { "min": 1500, "max": null }   // 기존 1000
}
```

### 추천 품질 vs 다양성 조정

추천이 너무 비슷한 항목만 나올 때:

```json
"recommendation": {
  "diversity_factor": 0.3,  // 기존 0.1 → 0.3으로 증가
  "min_score_threshold": 0.25  // 기존 0.3 → 0.25로 완화
}
```

### 모델 성능 개선 시도

과적합이 의심될 때:

```json
"model": {
  "n_factors": 30,      // 50 → 30 (복잡도 감소)
  "reg_all": 0.05,      // 0.02 → 0.05 (정규화 강화)
  "n_epochs": 15        // 20 → 15 (학습 줄임)
}
```

---

## 주의사항

1. **config.json 수정 후**: API 서버는 1시간마다 자동으로 핫리로드하므로 재시작 불필요
2. **Phase 수동 변경 금지**: `phase.current`와 `phase.interaction_count`는 `update_phase.py`만 수정해야 함
3. **실험 기록**: MLflow에 하이퍼파라미터 변경 이력을 기록하여 최적 설정 추적
4. **백업**: 중요한 변경 전에는 config.json을 복사해두기

---

## 문제 해결

### Q: Phase가 전환되지 않아요
**A**: `update_phase.py` 스크립트가 정상 실행되는지 확인하세요. cron 로그와 `phase.interaction_count` 값을 확인합니다.

### Q: 추천 품질이 낮아요
**A**: 
1. `min_score_threshold`를 높여보세요 (0.3 → 0.5)
2. MF 모델 하이퍼파라미터 튜닝 시도
3. MLflow에서 모델 성능 지표 확인

### Q: API 응답이 느려요
**A**:
1. 캐시가 활성화되어 있는지 확인 (`cache.enabled: true`)
2. Redis 연결 상태 확인
3. `default_limit`를 줄여보세요 (20 → 10)

### Q: 추천이 너무 단조로워요
**A**: `diversity_factor`를 증가시키세요 (0.1 → 0.3~0.5)